<!DOCTYPE HTML>
<html> 

    <head>
        <title>CSR kiosk</title>
        <meta charset="utf8">
        <link rel="stylesheet" type="text/css" href="./css/my.css">
        <link rel="shortcut icon" href="#">
    </head>
    <script src="./js/signage.base.js"></script>
    <script src="./js/sweetalert.min.js"></script>
    <style>
        h1 {
            text-align: center;
            margin-top: 3%
        }

        h2 {
            text-align: left;
            margin-left: 15%;
            color: rgb(155, 89, 182)
        }

        h3 {
            text-align: right;
            margin-right: 15%
        }
        body {
            //background-color: rgb(41,41,41);
            overflow-y: hidden;
        }
        #contents {
            display : flex;
            align-items: center;
            float : center;
            margin : 0 auto;
            width : 95%;
            //background-color: rgba(134, 134, 134, 0.5);
            //border-radius: 5px;
            //border : 2px solid whitesmoke;
        }
        header {
            height : 100px;
            line-height: 100px;
            text-align: center;
            font-size : 30px;
            color : whitesmoke;
        }
        .no_use_room {
            vertical-align: bottom;
            text-align: center;
            display : inline-block; 
            width : 15%; 
            min-height : 150px; 
            margin-right : 0.5%;
            margin-left : 0.5%;
            margin-bottom: 1%; 
            background-color: rgb(227, 203, 252);
        }
        .use_room { 
            vertical-align: bottom;
            text-align: center;
            display : inline-block; 
            width : 15%; 
            margin-right : 0.5%;
            margin-left : 0.5%;
            margin-bottom: 1%; 
            min-height : 150px; 
            background-color: rgb(174, 104, 244);
        }
        #rooms {
            width : 90%;
            margin : 0 auto;
        }
        .swal-button--confirm { 
            background-color: rgb(255, 103, 103);
        }
        .modal_use_cards{
            position: relative;
            display : inline-block; text-align: center; margin-right : 5px; width : 30%; font-weight: bold;
            font-size : 32px; padding-top : 35px; padding-bottom: 35px; border-radius: 25px;
            background: linear-gradient(90deg, rgba(108,92,231,1) 0%, rgba(97,76,255,1) 36%, rgba(52,36,255,1) 100%);
            margin-bottom: 10px;
        }
    </style>
    <body>
        <h1>예약</h1>
        <h3>CSR</h3>
        <h2>방 선택</h2>
        <div id="contents">
            <div id="rooms">
            </div>
        </div>
        <!-- room id in frame info example -->
        <div style="display : none">
            <div onclick="user_click_room(this)" room="use" class="use_room"></div>
            <div onclick="user_click_room(this)" room="no_use" class="no_use_room"></div>
        </div>
        <!-- 결제하기 버튼, 첫 화면으로 -->
        <footer style="margin : 0 auto; width : 50%; margin-top : 30px; text-align: center;">
        	<button type="button" onclick="window.location.href='index.html'"
                        style="color: #fff; background:#5E42A6; border-radius:0.5em; padding:10px 40px; font-size: 20px;">
                         홈으로
                </button>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <button type="button" onclick="payment_room();"
                        style="color: #fff; background:#5E42A6; border-radius:0.5em; padding:10px 30px; font-size: 20px;">
                        결제하기
                </button>
                
        </footer>
        <!-- modal -->
        <div class="modal" id="modal">
            <div class="modal-content">
                <div style="height : 100px;"></div>
                <div style="background-color :rgb(255, 255, 255); text-align: center; width : 100%; margin : 0 auto;">
                    <br><span style="font-size : 50px; color : #2d3436;">요금제를 선택해주세요</span><br><br><br>
                    <div onclick="login();" style="
                    display : inline-block; width : 40%; margin-right : 2%; padding-bottom: 40px; padding-top : 40px; vertical-align: bottom;
                    background: linear-gradient(174deg, rgba(116,185,255,1) 0%, rgba(55,161,244,1) 43%, rgba(9,132,227,1) 100%);
                    border-radius: 20px;
                    ">
                        <img src="svg/star.svg" alt="img" style="width : 150px;" ><br><br>
                        <span style="font-size : 36px; font-weight: bold; color : whitesmoke;" >회원 요금제</span>
                    </div>
                    <div onclick="non_members();" style="
                    display : inline-block; width : 40%; padding-bottom : 40px; padding-top : 40px; vertical-align: bottom; 
                    background: linear-gradient(174deg, rgba(223,230,233,1) 0%, rgba(178,190,195,1) 43%, rgba(99,110,114,1) 100%);
                    border-radius: 20px;
                    ">
                        <img src="svg/user.svg" alt="img" style="width : 180px;"><br><br>
                        <span style="font-size : 36px; font-weight: bold; color : whitesmoke;">비회원 요금제</span>
                    </div>
                    <br><br><br>
                    <div onclick="modal('close');" style="text-align: center; width : 25%; background-color: rgb(255, 103, 103);
                    margin : 0 auto; padding-top : 20px; padding-bottom: 20px; font-size : 24px; font-weight: bold; color : whitesmoke;"> 닫기 </div>
                    <br><br>
                </div>
            </div>
        </div>
        <!-- img modal -->
        <div class="modal" id="img_modal" style="display : none;">
            <div style="display : inline-block; position : absolute; width : 50%; text-align: center; top : 10%; left : 50%; transform: translateX(-50%);">
                <img src="images/CSR.png" alt="img" style="width: 90%;">
                <div style="display : inline-block; padding : 20px; padding-left : 40px; padding-right : 40px; 
                border: whitesmoke solid 2px; background-color: #2d3436; color : whitesmoke; font-weight: bold;
                font-size : 24px; border-radius: 20px; margin-top : 15px;
                " onclick="img_modal.style.display='none'">닫기</div>
            </div>
        </div>
        <!-- modal : 사용가능금액 - 사용 -->
        <div class="modal" id="modal_use" style="background-color: rgba(0, 0, 0, 0.8); display: none;">
            <div class="modal-content" style="padding : 40px; text-align: center; background-color: rgb(241, 241, 241); border-radius: 20px; margin-top : 10%; position: relative;">
                <div style="position : absolute; display: inline-block; padding : 20px; padding-left: 35px; padding-right: 35px; background-color: whitesmoke; border-radius: 20px;
                top : -25%; font-size: 24px; left : 0; color : rgb(65, 65, 65)">
                    <span style="font-weight: bold;">비회원</span>, 결제를 이용합니다.
                </div>
                <div class="modal_use_cards" onclick="non_members(1000, '2곡', 'coin');">
                    <span style="display : inline-block; color : whitesmoke; font-size : 24px; margin-bottom: 15px;">2곡</span>
                    <hr>
                    <span style="display : inline-block; font-weight : 100; color : whitesmoke; margin-top : 15px;">1,000원</span>
                    <img src="svg/money_coin.svg" alt="img" width="50px" style="position: absolute; top : 35%; left : 10px;">
                </div>
                <div class="modal_use_cards" onclick="non_members(2000, '4곡', 'coin');">
                    <span style="display : inline-block; color : whitesmoke; font-size : 24px; margin-bottom: 15px;">4곡</span>
                    <hr>
                    <span style="display : inline-block; font-weight : 100; color : whitesmoke; margin-top : 15px;">2,000원</span>
                    <img src="svg/money_coin.svg" alt="img" width="50px" style="position: absolute; top : 35%; left : 10px;">
                </div>
                <div class="modal_use_cards" onclick="non_members(3000, '6곡', 'coin')">
                    <span style="display : inline-block; color : whitesmoke; font-size : 24px; margin-bottom: 15px;">6곡</span>
                    <hr>
                    <span style="display : inline-block; font-weight : 100; color : whitesmoke; margin-top : 15px;">3,000원</span>
                    <img src="svg/money_coin.svg" alt="img" width="50px" style="position: absolute; top : 35%; left : 10px;">
                </div>
                <div class="modal_use_cards" onclick="non_members(5000, '12곡', 'coin')">
                    <span style="display : inline-block; color : whitesmoke; font-size : 24px; margin-bottom: 15px;">12곡</span>
                    <hr>
                    <span style="display : inline-block; font-weight : 100; color : whitesmoke; margin-top : 15px;">5,000원</span>
                    <img src="svg/money_coin.svg" alt="img" width="50px" style="position: absolute; top : 35%; left : 10px;">
                </div>
                <div class="modal_use_cards" style="background: tomato;" onclick="non_members(4000, '30분', 'time');">
                    <span style="display : inline-block; color : whitesmoke; font-size : 24px; margin-bottom: 15px;">30분</span>
                    <hr>
                    <span style="display : inline-block; font-weight : 100; color : whitesmoke; margin-top : 15px;">4,000원</span>
                    <img src="svg/time_coin.svg" alt="img" width="75px" style="position: absolute; top : 27%; left : 3px;">
                </div>
                <div class="modal_use_cards" style="background: tomato;" onclick="non_members(7000, '60분', 'time');">
                    <span style="display : inline-block; color : whitesmoke; font-size : 24px; margin-bottom: 15px;">60분</span>
                    <hr>
                    <span style="display : inline-block; font-weight : 100; color : whitesmoke; margin-top : 15px;">7,000원</span>
                    <img src="svg/time_coin.svg" alt="img" width="75px" style="position: absolute; top : 27%; left : 3px;">
                </div>
                <div onclick="modal_use.style.display='none'" style="position: absolute; display: inline-block; bottom : -25%; left : 50%; transform: translateX(-50%);
                background-color: rgb(85, 85, 85); padding : 20px; padding-left : 30px; padding-right: 30px; border-radius: 20px; border : 2px whitesmoke solid;
                font-weight: bold; color : whitesmoke; font-size : 18px;">
                    <img src="svg/logout.svg" width="20px">&nbsp; 취소
                </div>
            </div>
        </div>
        <!-- loading modal -->
        <div class="modal" style="display : none;" id="loading_modal">
            <div class="lds-ring-wrap" >
                <div class="lds-ring">
                    <div></div><div></div><div></div><div></div>
                </div>
                <div style="text-align: center; font-size : 24px; font-weight: bold; color : whitesmoke">결제 중</div>
            </div>
        </div>
    </body>
    <script>
        config_width();
        document.getElementById("contents").style.height = (height-300) + "px";

        var select_room = undefined;
        var rooms = document.getElementById("rooms");
        function user_click_room(obj){
            rooms.childNodes.forEach(i=>{
                if ( i.data != undefined ) return;
                i.removeAttribute("style");
            });
            if ( obj.style.backgroundColor != "rgb(241, 196, 15)" ) obj.style.backgroundColor = "#f1c40f";
            else obj.removeAttribute("style");
            select_room = obj;
        }
        var img_modal = document.getElementById("img_modal");
        var modal_use = document.getElementById("modal_use");
        var loading_modal = document.getElementById("loading_modal");
        function modal(obj){
            if ( obj == "close" ){
                document.getElementById("modal").style.display = "none";
                return;
            }
            document.getElementById("modal").style.display = "block";
        }
        function payment_room(){
            if ( select_room == undefined ) {
                swal({ title: "방을 먼저 선택해주세요. :D", text: "원하시는 방을 선택하여, 결제하기를 눌러주세요.", icon: "warning", button : "확인" });
                return;
            }
            if ( select_room.getAttribute("room") == "use" ){
                // 사용중
                swal({ title: "사용중인 방입니다.", text: "예약하시려면 확인을 눌러주세요.", icon: "warning", buttons : ["취소", "확인"] }).then((ok)=>{
                    if ( ok ) {
                        return;
                    }
                    else {
                        return;
                    }
                });
                return;
            } else {
                // 빈방
                modal();
                return;
            }
        }
        function login(){
            let room_number = select_room.getAttribute("room_num");
            window.location.href = "login.html?num=" + room_number;
        }
        // 비회원 결제
        function non_members(value, num, system){
            let room_number = select_room.getAttribute("room_num");
            if (typeof value == "undefined" ) {
                modal_use.style.display = "block";
                return;
            }
            alerted(function(){
                var data = new FormData();
                data.append("func", "non_member_use");
                data.append("room_num", room_number);
                data.append("system", system);
                data.append("value", value);
                data.append("num", parseInt(num));
                POST("design_pattern.php", data, function(resp){
                    if ( resp.data == "this room is already used" ){
                        alerted(function(){ 
                            window.location.reload();
                            return; 
                        }, "선택하신 방이 이미 사용중입니다..", "다른 방을 선택해주세요.", "error");
                        return;
                    }
                    loading_modal.style.display = "block";
                    setTimeout(function(){
                        loading_modal.style.display = "none";
                        alerted(function(){
                        window.location.href = "index.html";
                        }, room_number + "번 방에 충전을 완료했습니다.", "방으로 입실해주시고 사용해주세요.", "success");
                    }, 2000);
                });
            }, room_number + "번 방에 " + num + "을 충전합니다.", "선택한 방이 맞으시다면, 확인을 눌러주세요.", "warning", ["취소", "확인"]); 
        }
        var room_setting = function(){
            var data = new FormData();
            data.append("func", "room_setting");
            POST("design_pattern.php", data, function(resp){
                // console.log(resp.data.roominfo);
                let roominfo = resp.data.roominfo;
                let all_room = roominfo.all_room;
                for (let index = 1; index <= all_room; index++) {
                    index += "";
                    const each_room = roominfo[index];
                    let div = document.createElement("div");
                    div.setAttribute("room_num", index);
                    if ( each_room.use == false ){
                        div.setAttribute("room", "no_use");
                        div.setAttribute("class", "no_use_room");
                        div.setAttribute("onclick", "user_click_room(this)");
                        div.innerHTML = index + ". 빈 방";
                        rooms.appendChild(div);
                    } else { // use
                        div.setAttribute("room", "use");
                        div.setAttribute("class", "use_room");
                        div.setAttribute("onclick", "user_click_room(this)");
                        div.innerHTML = index + ". 사용 중";
                        if ( each_room.system == "coin" ){
                            div.innerHTML += "<div>" + each_room.coin + " coin </div>" ;
                        } else {
                            div.innerHTML += "<div>" + each_room.time + " time </div>" ;
                        }
                        rooms.appendChild(div);
                    }
                }
            });
        }
        room_setting();
    </script>
</html>